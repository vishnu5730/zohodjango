{% extends 'base.html' %}
{% block content %}
{% load static %}

<style>
  #over:hover{
        background-color: rgba(110, 110, 110, 0.616);
        
    }
</style>

  <div  style="top: 7rem; " >
    <div class="pb-4"><a class="text-white" style="font-size: 2rem;">All Purchases</a></div>
    <div class="row mb-4">
      
      <div class=" col-md-3 d-flex justify-content-between align-items-center">
      </div>
      <div class="col-md-6"></div>
      <div class="col-md-3 d-flex justify-content-end">
          <a class="btn btn-outline-warning p-2 mr-2" onclick="exportAsXLS()"><i class="fa fa-file-excel-o" aria-hidden="true"></i>EXCEL</a>&nbsp;
      </div>
  </div>
  <div class="row mb-4">
      
    <div class=" col-md-3 d-flex justify-content-between align-items-center">
      
            <input type="text" id="search" placeholder="Search..." class="form-control text-dark bg-light" autocomplete="off">
            <!-- <a href="" class="btn btn-outline-warning fa fa-sort text-right px-3 py-2" role="button"
            style="margin-left: 5px;"></a> -->
            <a class="btn text-center px-3 py-2 btn-outline-warning" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
            role="button" style="margin-left: 5px;"><i class="fa fa-sort "></i>
            </a>
            <div class="dropdown-menu ">
                <a class="dropdown-item" href="{% url 'purchaseView' %}">All</a>
                <a class="dropdown-item" href="{% url 'purchaseView_by_name' %}">Name</a>
                <a class="dropdown-item" href="{% url 'purchaseView_by_ord_no' %}">Purchase Order No</a>
            </div>
            
    </div>
    <div class="col-md-6"></div>
    <div class="col-md-3 d-flex justify-content-end">
        
        <a class="btn text-center px-4 pt-2 btn-outline-warning" data-bs-toggle="dropdown" aria-haspopup="true" aria-expanded="false"
        role="button" ><i class="fa fa-filter"></i>
        </a>
        <div class="dropdown-menu ">
            <a class="dropdown-item" href="{% url 'purchaseView' %}">All</a>
            <a class="dropdown-item" href="{% url 'drf' %}">Draft</a>
            <a class="dropdown-item" href="{% url 'apr' %}">Save</a>
        </div>
        <a href="{% url 'purchase_order' %}" class="btn btn-outline-warning fa fa-plus text-right px-3 py-2" role="button" style="margin-left: 5px;">
            <span class="mt-2">&nbsp;&nbsp;New</span>
        </a></div>
</div>
        <!-- <div class="row">
            
            <div class="col-md-6 form-inline" style="margin-left: 55rem;margin-top: -2rem;"><a style="color: #ccc;background-color: rgb(190, 131, 4);" class="btn  mr-2"  href="{% url 'vendor' %}"><i class="fa-solid fa-plus "></i>New</a>

            </div>
        </div>    -->
    
        <div class="row">
            <div class="col-sm-12 ">
              <div style="width: 100%; overflow-x: auto;">
                <table class="table  text-white" id="myTable" >
                    <thead>
                      <tr>
                        <th>DATE</th>
                            <th>ORD NUMBER</th>
                            <th>VENDOR</th>
                            <th>E-MAIL</th>
                            <th>TOTAL AMOUNT</th>
                            <th>BALANCE</th>
                            <th>STATUS</th>
                            <th>ACTION</th>
                      </tr>
                    </thead>
                    <tbody>
                        {% for v in pt %}
                      <tr id="over" class="clickable-row" data-href="{% url 'purchase_bill_view' v.id %}">
                        <td>{{v.Ord_date}}</td>
                        <td>{{v.Pur_no}}</td>
                        <td>{{v.vendor_name}} </td>
                        <td>{{v.vendor_mail}} </td>
                        <td>{{v.grand_total}}</td>
                        <td>{{v.grand_total}}</td>
                        <td>{{v.status}}</td>
                        {% if i.complete_status == 0 %}
                <td style="text-align: center;" data-href="#">
                  <div class="dropdown ">
                    <a class="dropdown-toggle btn btn-outline-warning" href="" data-toggle="dropdown">
                      CONVERT
                    </a>
                    <div class="dropdown-menu m-1">
                      <a class="dropdown-item" href="{% url 'convert_to_invoice_purchase' i.id %}">Convert to Invoie</a>
                      <a class="dropdown-item" href="{% url 'convert_to_recinvoice_frm_purchaseorder' i.id %}">Convert to Reccurring
                        Invoice</a>
                    </div>
                </td>
                {% elif i.complete_status == 1 %}
                <td style="text-align: center;" class="text-success m-2" data-href="#">Converted to Invoice</td>
                {% else %}
                <td style="text-align: center;" class="text-success m-2" data-href="#">Converted to Reccuring Invoice</td>
                {% endif %}
                        <td>
                            <a style="border-radius: 50%;"  href="{% url 'purchase_delet' v.id %}"><i class="fa fa-trash-o" style="font-size:24px"></i>
                            </a>
                        </td>
                      </tr>
                      {% endfor %}
                    </tbody>
                </table>
                </div>
                <br><br><br><br><br>
            </div>
            <div class="col-sm-12 col-md-1 col-lg-1"></div>

        </div>
    <!-- </div> -->

</div>


<script>
  $(document).ready(function () {
    $("#search").on("keyup", function () {
      var value = $(this).val().toLowerCase();
      $("#myTable tr").filter(function () {
        $(this).toggle($(this).text().toLowerCase().indexOf(value) > -1)
      });
    });
  });
</script>

<script>
  // Add click event listener to all rows with class "clickable-row"
  const rows = document.querySelectorAll('.clickable-row');
  rows.forEach(row => {
    row.addEventListener('click', () => {
      // Get the URL from the "data-href" attribute
      const url = row.getAttribute('data-href');
      // Navigate to the URL
      window.location.href = url;
    });
  });

  function exportAsXLS() {
            // Assuming you have data in a table format, you can export it to Excel using SheetJS
            const table = document.querySelector('table');
            const ws = XLSX.utils.table_to_sheet(table);
            const wb = XLSX.utils.book_new();
            XLSX.utils.book_append_sheet(wb, ws, 'Sheet1');
            XLSX.writeFile(wb, 'purchase_order.xlsx');
    }
</script>
{% endblock %}